## :kr: 빌드하는 방법

<br />

---

- (1) `model.hpp` 파일에 구조체(`struct`)를 정의한다.
   - `model.hpp`
```cpp
#pragma once
#ifndef MODEL_HPP
#define MODEL_HPP

#include <string>
#include <vector>

namespace hello::world {

struct Project {
    std::string title = "";
    std::vector<std::string> tags = {};
};

struct Profile {
    std::string email = "";
    double score = 0.0;
};

struct User {
    std::string name = "";
    int age = 0;
    bool admin = false;
    Profile profile = Profile{};
    std::vector<Project> projects = std::vector<Project>{};
};

} // namespace

struct NonNamespaceProfile {
    std::string email = "";
    double score = 0.0;
};

#endif // MODEL_HPP
```

<br />

---

- (2) `model.hpp` 파일을 `describe_all.gen.hpp` 파일로 변환한다.
   - 변환 방법
      - 현재 구성된 cmake 파일을 이용.
      - 또는 `tools/make_*` 스크립트 파일을 이용.
      - 또는 `describe_all.gen.hpp` 파일은 수작업으로 작성.
   - `describe_all.gen.hpp`
```cpp
// This file is generated by gen_all_structs.py - DO NOT EDIT
#pragma once

#include <boost/describe.hpp>

BOOST_DESCRIBE_STRUCT(NonNamespaceProfile, (), (email, score))
namespace hello {
namespace world {

BOOST_DESCRIBE_STRUCT(Profile, (), (email, score))
BOOST_DESCRIBE_STRUCT(Project, (), (title, tags))
BOOST_DESCRIBE_STRUCT(User, (), (name, age, admin, profile, projects))

} // namespace world
} // namespace hello
```


<br />

---

- (3) 해당 파일(`describe_all.gen.hpp`)을 `#include` 하여 사용한다. 다음 예제는 `main.cpp` 파일이다.
   -  `main.cpp`
```cpp
// main.cpp

#include "model.hpp"
#include "AutoDescribe.hpp"
#include "describe_all.gen.hpp"   // describe first
#include "JsonCodec.hpp"          // then JsonCodec

#include <iostream>
#include <string>
#include <vector>

int main() {
    try {
        hello::world::User u1{
            "Hong Gil-dong",
            29,
            true,
            hello::world::Profile{"hong@example.com", 98.5},
            {
                hello::world::Project{"VisionAI", {"rtsp", "opencv", "tracking"}},
                hello::world::Project{"Backend",  {"cpp", "asio", "protobuf"}}
            }
        };

        std::string s1 = JsonCodec::toString(u1, true);
        std::cout << "[User -> JSON]\n" << s1 << "\n\n";

        const char* js = R"({
            "name": "Lee Mong-ryong",
            "age": 21,
            "admin": false,
            "profile": { "email": "lee@example.com", "score": 91.2 },
            "projects": [
                { "title": "Render", "tags": ["vulkan", "pbr"] },
                { "title": "Network", "tags": ["cpp", "boost", "http"] }
            ]
        })";

        hello::world::User u2 =
            JsonCodec::fromString<hello::world::User>(js, JsonCodec::MissingPolicy::Strict);

        std::cout << "[JSON -> User] "
                  << "name="   << u2.name
                  << ", age="  << u2.age
                  << ", admin="<< (u2.admin ? "true":"false")
                  << ", email="<< u2.profile.email
                  << ", score="<< u2.profile.score
                  << ", projects=" << u2.projects.size() << " items\n";
        if (!u2.projects.empty()) {
            std::cout << "  First project: " << u2.projects[0].title << "\n";
        }

        JsonCodec::saveFile("user.json", u1, true);

        hello::world::User u3 =
            JsonCodec::loadFile<hello::world::User>("user.json", JsonCodec::MissingPolicy::Lenient);

        std::cout << "[File Load] name=" << u3.name
                  << ", projects=" << u3.projects.size() << " items\n";

        NonNamespaceProfile nnp1;

    } catch (const std::exception& e) {
        std::cerr << "[Error] " << e.what() << "\n";
        return 1;
    }
    return 0;
}
```

  

